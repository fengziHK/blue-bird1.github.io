<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>metasploit python 模块是如何运行 | 青鸟 Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="开始metasploit的扩展实现的代码主要在metasploit-framework/lib/msf/core/modules/external目录结构如下123456789101112131415161718├── bridge.rb├── message.rb├── python│   ├── async_timeout│   │   ├── __init__.py│   └── metas">
<meta name="keywords" content="编程技术">
<meta property="og:type" content="article">
<meta property="og:title" content="metasploit python 模块是如何运行">
<meta property="og:url" content="http://blue-bird1.github.io/2018/02/05/metasploit-python-模块是如何运行/index.html">
<meta property="og:site_name" content="青鸟 Blog">
<meta property="og:description" content="开始metasploit的扩展实现的代码主要在metasploit-framework/lib/msf/core/modules/external目录结构如下123456789101112131415161718├── bridge.rb├── message.rb├── python│   ├── async_timeout│   │   ├── __init__.py│   └── metas">
<meta property="og:locale" content="zh">
<meta property="og:updated_time" content="2018-05-31T01:34:08.831Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="metasploit python 模块是如何运行">
<meta name="twitter:description" content="开始metasploit的扩展实现的代码主要在metasploit-framework/lib/msf/core/modules/external目录结构如下123456789101112131415161718├── bridge.rb├── message.rb├── python│   ├── async_timeout│   │   ├── __init__.py│   └── metas">
  
    <link rel="alternate" href="/atom.xml" title="青鸟 Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/plugin/bganimation/bg.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://avatars3.githubusercontent.com/u/31133259?s=460&amp;v=4">
    <h2 class="author">bluebird</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>7</strong><br>文章</div></a>
      <a href="/categories"><div><strong>0</strong><br>分类</div></a>
      <a href="/tags"><div><strong>4</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main"><article id="post-metasploit-python-模块是如何运行" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/05/metasploit-python-模块是如何运行/" class="article-date">
  <time class="post-time" datetime="2018-02-05T01:33:23.000Z" itemprop="datePublished">
    <span class="post-month">2月</span><br/>
    <span class="post-day">05</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      metasploit python 模块是如何运行
    </h1>
  

        <div>
          
          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>metasploit的扩展实现的代码主要在<code>metasploit-framework/lib/msf/core/modules/external</code><br>目录结构如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">├── bridge.rb</span><br><span class="line">├── message.rb</span><br><span class="line">├── python</span><br><span class="line">│   ├── async_timeout</span><br><span class="line">│   │   ├── __init__.py</span><br><span class="line">│   └── metasploit</span><br><span class="line">│       ├── __init__.py</span><br><span class="line">│       ├── __init__.pyc</span><br><span class="line">│       ├── module.py</span><br><span class="line">│       ├── module.pyc</span><br><span class="line">│       ├── probe_scanner.py</span><br><span class="line">├── shim.rb</span><br><span class="line">└── templates</span><br><span class="line">    ├── capture_server.erb</span><br><span class="line">    ├── common_metadata.erb</span><br><span class="line">    ├── dos.erb</span><br><span class="line">    ├── multi_scanner.erb</span><br><span class="line">    └── remote_exploit_cmd_stager.erb</span><br></pre></td></tr></table></figure></p>
<p>其中<code>python</code>目录的py代码将会在我们运行python模块时加入python路径.这也是为什么我们能导入<code>metasploit</code><br><code>templates</code>目录则是用于实现将python代码变成模块的代码模板.事实上我们能使用msf对正常模块的功能 如<code>info</code>都是靠这些模板实现的.<br><code>message.rb</code>和<code>bridge</code>是与msf jsonrpc通信的一些api.<br><code>shim.rb</code>则是真正将python代码实现为模块的代码.</p>
<p>这里省略了不重要的细节的<code>message.rb</code>代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">class Msf::Modules::External::Message</span><br><span class="line"> </span><br><span class="line">  def self.from_module(j)                                                                                        </span><br><span class="line">    if j[&apos;method&apos;]</span><br><span class="line">      m = self.new(j[&apos;method&apos;].to_sym)</span><br><span class="line">      m.params = j[&apos;params&apos;]</span><br><span class="line">      m</span><br><span class="line">    elsif j[&apos;response&apos;]</span><br><span class="line">      m = self.new(:reply)</span><br><span class="line">      m.params = j[&apos;response&apos;]</span><br><span class="line">      m.id = j[&apos;id&apos;]</span><br><span class="line">      m</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line"> </span><br><span class="line">  def initialize(m)</span><br><span class="line">    self.method = m</span><br><span class="line">    self.params = &#123;&#125;</span><br><span class="line">    self.id = Base64.strict_encode64(SecureRandom.random_bytes(16))</span><br><span class="line">  end</span><br><span class="line"> </span><br><span class="line">  def to_json</span><br><span class="line">    params =</span><br><span class="line">      if self.params.respond_to? :to_nested_values</span><br><span class="line">        self.params.to_nested_values</span><br><span class="line">      else</span><br><span class="line">        self.params.to_h</span><br><span class="line">      end</span><br><span class="line">    JSON.generate(&#123;jsonrpc: &apos;2.0&apos;, id: self.id, method: self.method, params: params&#125;)</span><br><span class="line">  end</span><br></pre></td></tr></table></figure></p>
<p>这个类实际上是对传递给metasploit的信息的一个封装.<br><code>initialize</code>是ruby的初始化方法 从这里可以看到它有三个属性<code>method</code> <code>params</code> <code>id</code> </p>
<p><code>from_module</code>方法则是用于将传递的参数转换成自身<br><code>to_json</code>方法很明显就是转换成一个可用的json(jsonrpc传递需要json格式)</p>
<p>这里是省略了不重要的细节的<code>bridge.rb</code>代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">require &apos;msf/core/modules/external/message&apos;</span><br><span class="line"></span><br><span class="line">class Msf::Modules::External::Bridge</span><br><span class="line">  </span><br><span class="line">  # 通过jsonrpc运行</span><br><span class="line">  def run(datastore)</span><br><span class="line">    unless self.running</span><br><span class="line">      m = Msf::Modules::External::Message.new(:run)</span><br><span class="line">      m.params = datastore.dup</span><br><span class="line">      send(m)</span><br><span class="line">      self.running = true</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">	</span><br><span class="line">  # 获取当前状态和恢复run状态  </span><br><span class="line">  def get_status</span><br><span class="line">    if self.running || !self.messages.empty?</span><br><span class="line">      m = receive_notification</span><br><span class="line">      if m.nil?</span><br><span class="line">        close_ios</span><br><span class="line">        self.messages.close</span><br><span class="line">        self.running = false</span><br><span class="line">      end</span><br><span class="line"></span><br><span class="line">      return m</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">  </span><br><span class="line">  # 接收</span><br><span class="line">  def recv(filter_id=nil, timeout=600)</span><br><span class="line">    _, out, err = self.ios</span><br><span class="line">    message = &apos;&apos;</span><br><span class="line">  </span><br><span class="line">  # jsonrpc发送和接受</span><br><span class="line">  def send_receive(message)</span><br><span class="line">    send(message)</span><br><span class="line">    recv(message.id)</span><br><span class="line">  end</span><br><span class="line">  </span><br><span class="line">  # 发送模块元数据</span><br><span class="line">  def describe</span><br><span class="line">    resp = send_receive(Msf::Modules::External::Message.new(:describe))</span><br><span class="line">    close_ios</span><br><span class="line">    resp.params</span><br><span class="line">  end</span><br><span class="line">  	</span><br><span class="line">  # 发送  </span><br><span class="line">  def send(message)</span><br><span class="line">    input, output, err, status = ::Open3.popen3(self.env, self.cmd)</span><br><span class="line">    self.ios = [input, output, err]</span><br><span class="line">    self.wait_thread = status</span><br><span class="line">    case select(nil, [input], nil, 0.1)</span><br><span class="line">    when nil</span><br><span class="line">      raise &quot;Cannot run module #&#123;self.path&#125;&quot;</span><br><span class="line">    when [[], [input], []]</span><br><span class="line">      m = message.to_json</span><br><span class="line">      write_message(input, m)</span><br><span class="line">    else</span><br><span class="line">      raise &quot;Error running module #&#123;self.path&#125;&quot;</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">  </span><br><span class="line">  # TODO 这里原本有一大段关于网络接受的代码 </span><br><span class="line"></span><br><span class="line"># 每个编程语言扩展的具体实现</span><br><span class="line">class Msf::Modules::External::PyBridge &lt; Msf::Modules::External::Bridge</span><br><span class="line"> # 判断是否是py文件</span><br><span class="line">  def self.applies?(module_name)</span><br><span class="line">    module_name.match? /\.py$/</span><br><span class="line">  end</span><br><span class="line"> </span><br><span class="line">  # 初始化 python扩展添加了额外的路径</span><br><span class="line">  def initialize(module_path)</span><br><span class="line">    super</span><br><span class="line">    pythonpath = ENV[&apos;PYTHONPATH&apos;] || &apos;&apos;</span><br><span class="line">    self.env = self.env.merge(&#123; &apos;PYTHONPATH&apos; =&gt; pythonpath + File::PATH_SEPARATOR + File.expand_path(&apos;../python&apos;, __FILE__) &#125;)</span><br><span class="line">  end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Msf::Modules::External::Bridge</span><br><span class="line">  # 载入列表 我们可以期待更多的语言可以编写msf模块 如Msf::Modules::External::JsBridge?</span><br><span class="line">  LOADERS = [</span><br><span class="line">    Msf::Modules::External::PyBridge,</span><br><span class="line">    Msf::Modules::External::Bridge</span><br><span class="line">  ]</span><br><span class="line">	</span><br><span class="line">  # 运行模块方法 让载入的bridge都判断是否是自己所属的 </span><br><span class="line">  def self.open(module_path)</span><br><span class="line">    LOADERS.each do |klass|</span><br><span class="line">      return klass.new module_path if klass.applies? module_path</span><br><span class="line">    end</span><br><span class="line">    nil</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure></p>
<p>这里是省略了不重要的细节的<code>shim.rb</code>代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">require &apos;msf/core/modules/external/bridge&apos;</span><br><span class="line"></span><br><span class="line">class Msf::Modules::External::Shim</span><br><span class="line">  # 将bridge返回的数据生成一个模块</span><br><span class="line">  def self.generate(module_path)</span><br><span class="line">    mod = Msf::Modules::External::Bridge.open(module_path)</span><br><span class="line">    return &apos;&apos; unless mod.meta</span><br><span class="line">    # 这里根据模块元数据来选择模板 目前只有3个 元数据获取查看bridge.rb的meta方法 </span><br><span class="line">    case mod.meta[&apos;type&apos;]</span><br><span class="line">    when &apos;remote_exploit_cmd_stager&apos;</span><br><span class="line">      remote_exploit_cmd_stager(mod)</span><br><span class="line">    when &apos;capture_server&apos;</span><br><span class="line">      capture_server(mod)</span><br><span class="line">    when &apos;dos&apos;</span><br><span class="line">      dos(mod)</span><br><span class="line">    when &apos;scanner.multi&apos;</span><br><span class="line">      multi_scanner(mod)</span><br><span class="line">    else</span><br><span class="line">      # TODO have a nice load error show up in the logs</span><br><span class="line">      &apos;&apos;</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">  </span><br><span class="line">  # 返回一个模块 erb是ruby的一个代码模板库</span><br><span class="line">  def self.render_template(name, meta = &#123;&#125;)</span><br><span class="line">    template = File.join(File.dirname(__FILE__), &apos;templates&apos;, name)</span><br><span class="line">    ERB.new(File.read(template)).result(binding)</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def self.common_metadata(meta = &#123;&#125;)</span><br><span class="line">    render_template(&apos;common_metadata.erb&apos;, meta)</span><br><span class="line">  end</span><br><span class="line">  </span><br><span class="line">  # 数据转换</span><br><span class="line">  def self.mod_meta_common(mod, meta = &#123;&#125;)</span><br><span class="line">    meta[:path]        = mod.path.dump</span><br><span class="line">    meta[:name]        = mod.meta[&apos;name&apos;].dump</span><br><span class="line">    meta[:description] = mod.meta[&apos;description&apos;].dump</span><br><span class="line">    meta[:authors]     = mod.meta[&apos;authors&apos;].map(&amp;:dump).join(&quot;,\n          &quot;)</span><br><span class="line"></span><br><span class="line">    meta[:options]     = mod.meta[&apos;options&apos;].map do |n, o|</span><br><span class="line">      &quot;Opt#&#123;o[&apos;type&apos;].camelize&#125;.new(#&#123;n.dump&#125;,</span><br><span class="line">        [#&#123;o[&apos;required&apos;]&#125;, #&#123;o[&apos;description&apos;].dump&#125;, #&#123;o[&apos;default&apos;].inspect&#125;])&quot;</span><br><span class="line">    end.join(&quot;,\n          &quot;)</span><br><span class="line">    meta</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line"> # 渲染膜拜</span><br><span class="line">  def self.dos(mod)</span><br><span class="line">    meta = mod_meta_common(mod)</span><br><span class="line">    meta[:date] = mod.meta[&apos;date&apos;].dump</span><br><span class="line">    meta[:references] = mod.meta[&apos;references&apos;].map do |r|</span><br><span class="line">      &quot;[#&#123;r[&apos;type&apos;].upcase.dump&#125;, #&#123;r[&apos;ref&apos;].dump&#125;]&quot;</span><br><span class="line">    end.join(&quot;,\n          &quot;)</span><br><span class="line">    render_template(&apos;dos.erb&apos;, meta)</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure></p>
<p>所以python模块的运行过程其实是这样的</p>
<ol>
<li>class Msf::Modules::External::Shim获取到了模块路径</li>
<li>调用Msf::Modules::External::Bridge.open</li>
<li>在open方法 Msf::Modules::External::PyBridge::applies判断成功(也就是确认了是python模块)</li>
<li>初始化一个Msf::Modules::External::PyBridge并返回</li>
<li>判断元数据类型 假设是dos 则调用dos方法</li>
<li>调用mod_meta_common方法转换元数据 渲染代码模板</li>
</ol>
<p>我们可以查看<code>dos.erb</code>的内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">require &apos;msf/core/modules/external/bridge&apos;</span><br><span class="line">require &apos;msf/core/module/external&apos;</span><br><span class="line"></span><br><span class="line">class MetasploitModule &lt; Msf::Auxiliary</span><br><span class="line">  include Msf::Module::External</span><br><span class="line">  include Msf::Auxiliary::Dos</span><br><span class="line"></span><br><span class="line">  def initialize</span><br><span class="line">    super(&#123;</span><br><span class="line">	  &lt;%= common_metadata meta %&gt;</span><br><span class="line">      &apos;References&apos;  =&gt;</span><br><span class="line">        [</span><br><span class="line">          &lt;%= meta[:references] %&gt;</span><br><span class="line">        ],</span><br><span class="line">      &apos;DisclosureDate&apos; =&gt; &lt;%= meta[:date] %&gt;,</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      register_options([</span><br><span class="line">        &lt;%= meta[:options] %&gt;</span><br><span class="line">      ])</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  def run</span><br><span class="line">    print_status(&quot;Starting server...&quot;)</span><br><span class="line">    mod = Msf::Modules::External::Bridge.open(&lt;%= meta[:path] %&gt;)</span><br><span class="line">    mod.run(datastore)</span><br><span class="line">    wait_status(mod)</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure></p>
<p>所以事实上python模块的实现就是将python代码中元数据传递到代码模板 然后实际上调用的还是ruby模板 我们的python文件路径将会出现在<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mod = Msf::Modules::External::Bridge.open(&lt;%= meta[:path] %&gt;)</span><br><span class="line">mod.run(datastore)</span><br></pre></td></tr></table></figure></p>
<p>最后通过<code>bridge.run</code>调用.这种扩展方法不但没有失去对ruby模块的强大支持也没丢失python的灵活性 非常好</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blue-bird1.github.io/2018/02/05/metasploit-python-模块是如何运行/" data-id="cji113tpw0000r0nx5ofancvs" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/编程技术/">编程技术</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/05/22/findbug/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          寻找历史漏洞
        
      </div>
    </a>
  
  
    <a href="/2018/02/02/metasploit-python-模块/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">metasploit python 模块</div>
    </a>
  
</nav>

  
</article>



</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">青鸟 Blog</h1>
    <h2 class="blog-subtitle">青鸟的Blog</h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="https://avatars3.githubusercontent.com/u/31133259?s=460&amp;v=4">
    <h2 class="author">bluebird</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>7</strong><br>文章</div></a>
      <a href="/categories"><div><strong>0</strong><br>分类</div></a>
      <a href="/tags"><div><strong>4</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="http://github.com/blue-bird1" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
        <a class="hvr-bounce-in" href="https://jiaqiangbandongg.github.io/" target="_blank" title="李孟禹的日常">
          李孟禹的日常
        </a>
      
        <a class="hvr-bounce-in" href="https://zehuichen123.github.io/" target="_blank" title="loveSnowBest&#39;Blog">
          loveSnowBest&#39;Blog
        </a>
      
        <a class="hvr-bounce-in" href="http://yaoyaomeng.github.io" target="_blank" title="xyz&#39;blog">
          xyz&#39;blog
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2017 - 2018 bluebird<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  <link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">
  <script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>



  <link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">
  <script src="/plugin/galmenu/GalMenu.js"></script>
  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/" title="" class="menuItem">首页</a>
          
            <a href="/archives" title="" class="menuItem">归档</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>
<script src="/js/script.js"></script>



  </div>
</body>
</html>